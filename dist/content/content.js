let s="",c=!1;document.addEventListener("selectstart",()=>{c=!0});async function i(t){if(chrome?.runtime?.id)try{await chrome.runtime.sendMessage(t)}catch(e){const n=String(e?.message||e);if(n.includes("Extension context invalidated")||n.includes("Receiving end does not exist"))return;console.error("sendMessage failed: ",e)}}function l(t){let e=null;try{window.__linguistSim?.isActive&&(e=window.__linguistSim.getCurrentCueAndContext())}catch{}return{type:"SELECTION_CHANGED",payload:{text:t,cueText:e?.cue?.text||null,cueId:e?.cue?.id||null,contextCues:e?.contextCues||[],timeRange:e?.timeRange||null}}}document.addEventListener("mouseup",()=>{c=!1;const t=window.getSelection(),e=t.toString().trim(),n=!t.isCollapsed;if(n&&e!==""&&e!==s){const o=l(e);i(o),s=e,console.log(e),console.log(o.payload)}else!n&&s!==""&&(i(l("")),s="",console.log("Unselected text"))});document.addEventListener("selectionchange",()=>{const t=window.getSelection();if(!t)return;const e=t.toString().trim(),n=!t.isCollapsed;if(!n&&s!==""){i(l("")),s="",console.log("Unselected text");return}if(n&&!c&&e!==""&&e!==s){const o=l(e);i(o),s=e,console.log(o.payload)}});
