const h=`<!-- HTML for custom subtitle component -->

<div id="linguist-subtitles">
    <div class="subtitle-text"></div>
</div>`,x=":host{position:fixed;inset:0;z-index:2147483647;pointer-events:none}.subtitle-text{position:absolute;display:none;pointer-events:auto;-webkit-user-select:text;user-select:text;padding:0;background:transparent;border-radius:0;margin:0;max-width:none;text-shadow:none}.subtitle-text.visible{display:block;padding:6px 12px;background:#0009;border-radius:8px;color:#fff;font-size:22px;text-align:center;white-space:pre-wrap}";let r,o;function y(t){if(r)return;const e=document.createElement("template");e.innerHTML=h,r=e.content.firstElementChild;const n=document.createElement("style");n.textContent=x,t.appendChild(n),t.appendChild(r),o=r.querySelector(".subtitle-text")}function b({text:t,rect:e}){if(!o)return;if(!!!(t&&t.trim())){o.textContent="",o.classList.remove("visible");return}o.textContent=t,o.classList.add("visible"),e&&(o.style.left=`${e.left}px`,o.style.top=`${e.top+e.height+10}px`,o.style.width=`${e.width}px`)}function w(){return r}function v(t){const e=document.querySelector(".ytp-caption-window-container")||document.querySelector(".ytp-caption-window");if(!e)return null;const n=()=>[...document.querySelectorAll(".ytp-caption-segment")].map(p=>p.innerText).join(" ").trim(),c=()=>{const p=n(),d=e.getBoundingClientRect();t({text:p,rect:{top:d.top,left:d.left,width:d.width,height:d.height}})};c();const i=new MutationObserver(()=>c());return i.observe(e,{childList:!0,characterData:!0,subtree:!0}),()=>i.disconnect()}let s="",f=!1,m=null,l=document.getElementById("linguist-overlay");l||(l=document.createElement("div"),l.id="linguist-overlay",l.style.all="initial",document.documentElement.appendChild(l));const E=l.shadowRoot||l.attachShadow({mode:"open"});y(E);m=w?.();v(({text:t,rect:e})=>{b({text:t,rect:e})});function g(t){if(!m||!t)return!1;const e=t.nodeType===Node.TEXT_NODE?t.parentNode:t;return m.contains(e)}document.addEventListener("selectstart",()=>{f=!0});async function a(t){if(chrome?.runtime?.id)try{await chrome.runtime.sendMessage(t)}catch(e){const n=String(e?.message||e);if(n.includes("Extension context invalidated")||n.includes("Receiving end does not exist"))return;console.error("sendMessage failed: ",e)}}function u(t){return{type:"SELECTION_CHANGED",payload:{text:t,cueText:null,cueId:null,contextCues:[],timeRange:null}}}document.addEventListener("mouseup",()=>{f=!1;const t=window.getSelection(),e=t.toString().trim(),n=!t.isCollapsed,c=t.anchorNode||t.focusNode;if(!(n&&!g(c)))if(n&&e!==""&&e!==s){const i=u(e);a(i),s=e,console.log(e),console.log(i.payload)}else!n&&s!==""&&(a(u("")),s="",console.log("Unselected text"))});document.addEventListener("selectionchange",()=>{const t=window.getSelection();if(!t)return;const e=t.toString().trim(),n=!t.isCollapsed,c=t.anchorNode||t.focusNode;if(!(n&&!g(c))){if(!n&&s!==""){a(u("")),s="",console.log("Unselected text");return}if(n&&!f&&e!==""&&e!==s){const i=u(e);a(i),s=e,console.log(i.payload)}}});
