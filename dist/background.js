const o={};chrome.runtime.onMessage.addListener((t,n,r)=>{switch(t?.type){case"PING":{console.log("PING from ",n?.id,"message: ",t.payload),chrome.tabs.query({active:!0,currentWindow:!0},e=>{const[a]=e;chrome.tabs.sendMessage(a.id,{type:"PING"},c=>{c.ok&&console.log("Content script received PING!")})}),r({ok:!0,data:{pong:!0,ts:Date.now()}});return}case"SELECTION_CHANGED":{const e=n.tab?.id;if(!e){console.warn("No tab ID found for sender"),r({ok:!1,error:"NO_TAB_ID"});return}o[e]||(o[e]={savedText:"",cues:[]}),e&&(o[e].savedText=t.payload.text||""),console.log("Tab ",e," text:",o[e].savedText),r({ok:!0});return}case"GET_TEXT":return chrome.tabs.query({active:!0,currentWindow:!0},e=>{const[a]=e,c=o[a.id]?.savedText??"N/A";r({ok:!0,data:{text:c}})}),!0;default:console.warn("Unkown message type",t?.type),r({ok:!1,error:"UNKNOWN_MESSAGE_TYPE"})}});chrome.tabs.onRemoved.addListener(t=>{delete o[t],console.log("Cleaned up tab",t)});
